name: "Nested Branching Test"
version: "1.0"
description: "Test nested branching (branch inside branch)"

variables:
  base_url: "https://jsonplaceholder.typicode.com"
  timeout: "5s"
  test_value: 1

steps:
  - name: "Setup"
    description: "Set up test variables"
    request:
      method: "GET"
      url: "{{base_url}}/users/{{test_value}}"
      timeout: "{{timeout}}"
    validate:
      - status: 200
    capture:
      user_id: "$.id"
      user_name: "$.name"

  - name: "Test Nested If-Then-Else"
    description: "Test if/then/else inside if/then/else"
    if: "{{user_id}} > 0"
    then:
      - name: "Outer Then - Nested If"
        description: "This is in outer then, now test nested if"
        if: "{{user_id}} == 1"
        then:
          - name: "Inner Then - User ID is 1"
            print: "✓ Nested THEN: user_id == 1"
            request:
              method: "GET"
              url: "{{base_url}}/users/1"
              timeout: "{{timeout}}"
            validate:
              - status: 200
        else:
          - name: "Inner Else - User ID is not 1"
            print: "✓ Nested ELSE: user_id != 1"
            request:
              method: "GET"
              url: "{{base_url}}/users/{{user_id}}"
              timeout: "{{timeout}}"
            validate:
              - status: 200
    else:
      - name: "Outer Else"
        print: "✓ Outer ELSE: user_id <= 0"
        request:
          method: "GET"
          url: "{{base_url}}/users/1"
          timeout: "{{timeout}}"
        validate:
          - status: 200

  - name: "Test Nested Branches"
    description: "Test branches inside branches"
    branches:
      - condition: "{{user_id}} > 0"
        steps:
          - name: "Outer Branch 1 - Nested Branches"
            branches:
              - condition: "{{user_id}} == 1"
                steps:
                  - name: "Inner Branch 1 - User ID is 1"
                    print: "✓ Nested Branch 1: user_id == 1"
                    request:
                      method: "GET"
                      url: "{{base_url}}/users/1"
                      timeout: "{{timeout}}"
                    validate:
                      - status: 200
                priority: 10
              
              - condition: "{{user_id}} > 1"
                steps:
                  - name: "Inner Branch 2 - User ID > 1"
                    print: "✓ Nested Branch 2: user_id > 1"
                    request:
                      method: "GET"
                      url: "{{base_url}}/users/{{user_id}}"
                      timeout: "{{timeout}}"
                    validate:
                      - status: 200
                priority: 5
              
              - condition: "true"
                steps:
                  - name: "Inner Default"
                    print: "✓ Nested Default branch"
                    request:
                      method: "GET"
                      url: "{{base_url}}/users/{{user_id}}"
                      timeout: "{{timeout}}"
                    validate:
                      - status: 200
                priority: 1
        priority: 10
      
      - condition: "true"
        steps:
          - name: "Outer Default"
            print: "✓ Outer Default branch"
            request:
              method: "GET"
              url: "{{base_url}}/users/1"
              timeout: "{{timeout}}"
            validate:
              - status: 200
        priority: 1

  - name: "Test Mixed Nested Branching"
    description: "Test if/then/else inside branches and vice versa"
    if: "{{user_id}} == 1"
    then:
      - name: "Outer Then - Branches Inside"
        branches:
          - condition: "{{user_name}} != ''"
            steps:
              - name: "Branch in Then - Name exists"
                print: "✓ Branch in THEN: name exists"
                request:
                  method: "GET"
                  url: "{{base_url}}/users/1"
                  timeout: "{{timeout}}"
                validate:
                  - status: 200
            priority: 10
          
          - condition: "true"
            steps:
              - name: "Branch in Then - Default"
                print: "✓ Branch in THEN: default"
                request:
                  method: "GET"
                  url: "{{base_url}}/users/1"
                  timeout: "{{timeout}}"
                validate:
                  - status: 200
            priority: 1
    else:
      - name: "Outer Else - If Inside"
        if: "{{user_id}} > 1"
        then:
          - name: "If in Else - Then"
            print: "✓ IF in ELSE THEN: user_id > 1"
            request:
              method: "GET"
              url: "{{base_url}}/users/{{user_id}}"
              timeout: "{{timeout}}"
            validate:
              - status: 200
        else:
          - name: "If in Else - Else"
            print: "✓ IF in ELSE ELSE: user_id <= 1"
            request:
              method: "GET"
              url: "{{base_url}}/users/1"
              timeout: "{{timeout}}"
            validate:
              - status: 200

  - name: "Test Triple Nested"
    description: "Test three levels of nesting"
    if: "{{user_id}} > 0"
    then:
      - name: "Level 1 Then"
        if: "{{user_id}} == 1"
        then:
          - name: "Level 2 Then"
            if: "{{user_name}} != ''"
            then:
              - name: "Level 3 Then"
                print: "✓ Triple nested: All conditions met"
                request:
                  method: "GET"
                  url: "{{base_url}}/users/1"
                  timeout: "{{timeout}}"
                validate:
                  - status: 200
            else:
              - name: "Level 3 Else"
                print: "✓ Triple nested: Level 3 else"
                request:
                  method: "GET"
                  url: "{{base_url}}/users/1"
                  timeout: "{{timeout}}"
                validate:
                  - status: 200
        else:
          - name: "Level 2 Else"
            print: "✓ Triple nested: Level 2 else"
            request:
              method: "GET"
              url: "{{base_url}}/users/{{user_id}}"
              timeout: "{{timeout}}"
            validate:
              - status: 200
    else:
      - name: "Level 1 Else"
        print: "✓ Triple nested: Level 1 else"
        request:
          method: "GET"
          url: "{{base_url}}/users/1"
          timeout: "{{timeout}}"
        validate:
          - status: 200




